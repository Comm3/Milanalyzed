{
    "contents" : "\nlibrary(ggmap)\n\n# Setting the map\n\n# Carico le figure dei quartieri di Milano\nmilan_qt.wgs84 <- spTransform(milan_qt, CRS(\"+init=epsg:4326\"))\nmilan_qt.wgs84.f <- fortify(milan_qt.wgs84, region = \"ID_NIL\") %>%\n  merge(milan_qt.wgs84@data, by.x = \"id\", by.y = \"ID_NIL\")\n\n# Carico le figure delle zone di Milano\nmilan_zone <- readOGR(dsn = \"Dati/zone_dec\", layer = \"ZoneDecentramento\")\nmilan_zone.wgs84 <- spTransform(milan_zone, CRS(\"+init=epsg:4326\"))\nmilan_zone.wgs84.f <- fortify(milan_zone.wgs84, region = \"ZONADEC\") %>%\n  merge(milan_zone@data, by.x = \"id\", by.y = \"ZONADEC\")\n\n\n\n\n# b <- bbox(milan_qt.wgs84)\nb <- bbox(milan_zone.wgs84)\nb[1, ] <- (b[1, ] - mean(b[1, ])) * 1.2 + mean(b[1, ])\nb[2, ] <- (b[2, ] - mean(b[2, ])) * 1.2 + mean(b[2, ])\n# lnd.b1 <- ggmap(get_map(location = b))\n\n\n\n# Second approach\n# lnd.stamen <- ggmap(get_map(location = b, source = \"stamen\", maptype = \"toner\", \n# crop = T))\nlnd.gmaps <- ggmap(get_map(location = b, source = \"google\", maptype = \"roadmap\", \n                           crop = T))\nlnd.osm <- ggmap(get_map(location = b, source = \"osm\", maptype = \"roadmap\", \n                         crop = T))\n\n# Births and deaths\n\nlnd.osm + \n  geom_polygon(data = milan_qt.wgs84.f, \n               aes(x = long, y = lat, group = group, \n                   fill = \n                     cut(nascite/decessi,\n                              breaks = c(0,1,2,Inf),\n                              include.lowest = TRUE,\n                              right = FALSE,\n                              labels = c(\"Meno di 1\", \"Tra 1 e 2\", \"Oltre 2\")),\n                   alpha = \n                     cut((cittadini / (AreaMQ / 100)),\n                         breaks = c(0,5,10,20,Inf),\n                         include.lowest = TRUE,\n                         right = FALSE,\n                         labels = c(\"Meno di 5\", \"Tra 5 e 10\", \"Tra 10 e 20\", \"Oltre 20\"))\n               ), \n               # alpha = 0.5, \n               colour = \"black\", size = 0.25) + \n  geom_polygon(data = milan_zone.wgs84.f,\n               aes(long, lat, group = group),\n               fill = NA, color = \"black\", size = 1\n  ) +\n  labs(x = \"Longitudine\", y = \"Latitudine\", fill = \"Nascite per decesso\",\n       alpha = \"Densità citt./100mq 2014\") + \n  ggtitle(\"Tasso di natalità 2003/2014\") +\n  # scale_fill_distiller(palette = \"Greens\", breaks = pretty_breaks(n = 5)) +\n  guides(fill = guide_legend(reverse = TRUE))\n\n\n# Nationality\n\n\nlnd.osm + \n  geom_polygon(data = milan_qt.wgs84.f, \n               aes(x = long, y = lat, group = group, \n                   fill = seconda_cittadinanza,\n                   alpha = (secondi_cittadini / cittadini) * 100\n               ), \n               # alpha = 0.5, \n               colour = \"black\", size = 0.25) + \n  geom_polygon(data = milan_zone.wgs84.f,\n               aes(long, lat, group = group),\n               fill = NA, color = \"black\", size = 1\n  ) +\n  labs(fill = \"Cittadinanza\",\n       alpha = \"Perc. rispetto totale\") + \n  ggtitle(\"Seconda Nazionalità del quartiere 2014\") +\n  # scale_fill_distiller(palette = \"Greens\", breaks = pretty_breaks(n = 5)) +\n  guides(fill = guide_legend(reverse = TRUE))\n\n\n# Giovani senza filtro su nazionalità\nlnd.osm + \n  geom_polygon(data = milan_qt.wgs84.f, \n               aes(x = long, y = lat, group = group, \n                   fill = \n                     # Femmine_giovani/Uomini_giovani\n                     # Femmine_giovani\n                     cut(Femmine_giovani/Uomini_giovani,\n                         breaks = c(0,1,2,Inf),\n                         include.lowest = FALSE,\n                         right = FALSE,\n                         labels = c(\"Meno di 1\", \"Tra 1 e 2\", \"Oltre 2\"))\n                     ,\n                   alpha = \n                     cut((Femmine_giovani / (AreaMQ / 1000)),\n                         breaks = c(0,5,10,20,Inf),\n                         include.lowest = TRUE,\n                         right = FALSE,\n                         labels = c(\"Meno di 5\", \"Tra 5 e 10\", \"Tra 10 e 20\", \"Oltre 20\"))\n               ), \n               # alpha = 0.5, \n               colour = \"black\", size = 0.25) + \n  geom_polygon(data = milan_zone.wgs84.f,\n               aes(long, lat, group = group),\n               fill = NA, color = \"black\", size = 1\n  ) +\n  labs(x = NULL, y = NULL, fill = \"Rapporto donna/uomo\",\n       alpha = \"Donne per KmQ\") + \n  ggtitle(\"Donne tra i 25 e i 30 anni 2014\") +\n  # scale_fill_distiller(palette = \"Greens\", breaks = pretty_breaks(n = 5)) +\n  guides(fill = guide_legend(reverse = TRUE))\n\n\n# Giovani italiani\n\nlnd.osm + \ngeom_polygon(data = milan_qt.wgs84.f, \n             aes(x = long, y = lat, group = group, \n                 fill = \n                   # Femmine_giovani/Uomini_giovani\n                   # Femmine_giovani\n                   cut(Femmine_giovani_it/Uomini_giovani_it,\n                       breaks = c(0,1,2,Inf),\n                       include.lowest = FALSE,\n                       right = FALSE,\n                       labels = c(\"Meno di 1\", \"Tra 1 e 2\", \"Oltre 2\"))\n                 ,\n                 alpha = (Femmine_giovani_it / (AreaMQ / 1000))\n             ), \n             colour = \"black\", size = 0.25) + \n  geom_polygon(data = milan_zone.wgs84.f,\n               aes(long, lat, group = group),\n               fill = NA, color = \"black\", size = 1\n  ) +\n  labs(x = NULL, y = NULL, fill = \"Rapporto donna/uomo\",\n       alpha = \"Donne per KmQ\") + \n  ggtitle(\"Donne italiane tra i 25 e i 30 anni 2014\") +\n  # scale_fill_distiller(palette = \"Greens\", breaks = pretty_breaks(n = 5)) +\n  guides(fill = guide_legend(reverse = TRUE))\n\n",
    "created" : 1449008100065.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1805873704",
    "id" : "197A1159",
    "lastKnownWriteTime" : 1449181183,
    "path" : "~/Development/Milanalytics/Scripts/Map_plot.R",
    "project_path" : "Scripts/Map_plot.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}